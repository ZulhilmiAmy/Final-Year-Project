window.confirmGoLogin=function(t){confirm("Adakah anda pasti mahu kembali ke halaman Login?")&&(window.location.href=t)};window.confirmLogout=function(){confirm("Adakah anda pasti mahu log keluar?")&&document.getElementById("logout-form").submit()};window.goToHistory=function(t){const n=window.patientsHistoryUrl+"?no_kp="+encodeURIComponent(t);window.location.href=n};document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".go-login").forEach(t=>{t.addEventListener("click",function(n){n.preventDefault();let e=this.dataset.url;confirm("Adakah anda pasti mahu kembali ke halaman Login?")&&(window.location.href=e)})})});const m=document.getElementById("noKP"),d=document.getElementById("recordDisplay"),i=document.getElementById("recordDetails"),c=document.getElementById("recordButtons"),r=document.getElementById("clearBtn");m.addEventListener("input",function(){this.value.length===12&&u(this.value),r.style.display=this.value?"block":"none"});r.addEventListener("click",function(){p()});function u(t){fetch(window.patientsSearchUrl+"?no_kp="+t).then(n=>n.json()).then(n=>{if(n.exists===!0){const e=n.data.date?n.data.date:"-";i.innerHTML=`
                    <p><strong>NAMA PEMOHON :</strong> ${n.data.name}</p>
                    <p><strong>NO.KP :</strong> ${n.data.no_kp}</p>
                    <p><strong>TARIKH PERMOHONAN :</strong> ${e}</p>
                    <hr>`,c.innerHTML=`
                    <button class="option-btn history" onclick="goToHistory('${t}')">SEJARAH</button>
                    <button class="option-btn new-application" onclick="newApplication()">DAFTAR PERMOHONAN BARU</button>
                    <button class="option-btn cancel" onclick="hideRecordDisplay()">BATAL</button>
                    `}else i.innerHTML=`
                    <div class="no-record">REKOD TIDAK WUJUD!</div>
                    <hr>`,c.innerHTML=`
                    <button class="option-btn new-application" onclick="newApplication()">DAFTAR PERMOHONAN BARU</button>`;d.style.display="block"}).catch(n=>{console.error("Error:",n),i.innerHTML=`
                <div class="no-record">Ralat semasa carian.</div>
                <hr>`,c.innerHTML=`
                <button class="option-btn cancel" onclick="hideRecordDisplay()">BATAL</button>`,d.style.display="block"})}function p(){d.style.display="none",m.value="",r.style.display="none"}document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("calendar");window.calendar=new FullCalendar.Calendar(t,{initialView:"dayGridMonth",locale:"ms",editable:!1,selectable:!1,buttonText:{today:"Hari Ini"},events:function(n,e,l){fetch(window.appointmentsUpcomingUrl).then(o=>o.json()).then(o=>{const a=o.map(s=>({title:s.patient_name,start:s.date}));e(a)}).catch(o=>{console.error("Error loading calendar events:",o),l(o)})},eventClick:function(n){alert(`Pesakit: ${n.event.title}
Tarikh: ${n.event.start.toLocaleDateString("ms-MY")}`)}}),calendar.render(),h()});function h(){const t=document.getElementById("reminder-list");t.innerHTML='<div class="loading">Memuatkan...</div>',fetch(window.appointmentsUpcomingUrl).then(n=>n.json()).then(n=>{if(t.innerHTML="",n.length===0){t.innerHTML='<div class="no-appointments">Tiada temujanji akan datang.</div>';return}n.forEach(e=>{const o=new Date(e.date).toLocaleDateString("ms-MY",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),a=document.createElement("div");a.className="appointment-item",a.innerHTML=`
                    <div><strong>${e.patient_name}</strong></div>
                    <div style="font-size:0.9em;color:#666;">${o}</div>
                `,t.appendChild(a)})}).catch(n=>{console.error("Error loading appointments:",n),t.innerHTML='<div class="no-appointments">Ralat memuatkan temujanji.</div>'})}
